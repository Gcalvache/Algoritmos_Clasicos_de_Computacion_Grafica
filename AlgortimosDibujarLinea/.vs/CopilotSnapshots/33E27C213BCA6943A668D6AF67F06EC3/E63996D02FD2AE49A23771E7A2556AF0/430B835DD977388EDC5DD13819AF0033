using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace AlgortimosDibujarLinea
{
    public partial class frmMetodoDda : Form
    {
        public frmMetodoDda()
        {
            InitializeComponent();

            // Asociar eventos de botones
            btnCalcular.Click += BtnCalcular_Click;
            btnLimpiar.Click += BtnLimpiar_Click;
            btnSalir.Click += BtnSalir_Click;

            // Inicializar picturebox con bitmap
            pcbGrafico.Image = new Bitmap(pcbGrafico.Width, pcbGrafico.Height);
        }

        private void BtnSalir_Click(object sender, EventArgs e)
        {
            Close();
        }

        private void BtnLimpiar_Click(object sender, EventArgs e)
        {
            txtXi.Clear();
            txtYi.Clear();
            txtXf.Clear();
            txtYf.Clear();
            txtPendiente.Clear();

            if (pcbGrafico.Image != null)
            {
                using (Graphics g = Graphics.FromImage(pcbGrafico.Image))
                {
                    g.Clear(pcbGrafico.BackColor);
                }
                pcbGrafico.Invalidate();
            }
        }

        private void BtnCalcular_Click(object sender, EventArgs e)
        {
            int xi, yi, xf, yf;
            if (!int.TryParse(txtXi.Text, out xi) ||
                !int.TryParse(txtYi.Text, out yi) ||
                !int.TryParse(txtXf.Text, out xf) ||
                !int.TryParse(txtYf.Text, out yf))
            {
                MessageBox.Show("Ingrese coordenadas enteras válidas.", "Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            var linea = new Clinea(xi, yi, xf, yf);
            var puntos = linea.Discretize();

            txtPendiente.Text = double.IsInfinity(linea.Pendiente) ? "∞" : linea.Pendiente.ToString("F4");

            // Dibujar los puntos en el PictureBox
            if (pcbGrafico.Image == null)
            {
                pcbGrafico.Image = new Bitmap(pcbGrafico.Width, pcbGrafico.Height);
            }

            using (Graphics g = Graphics.FromImage(pcbGrafico.Image))
            {
                // Limpiar
                g.Clear(pcbGrafico.BackColor);

                // Transformar coordenadas: suponer origen en centro
                int cx = pcbGrafico.Width / 2;
                int cy = pcbGrafico.Height / 2;

                // Dibujar ejes
                using (var penAxis = new Pen(Color.LightGray))
                {
                    g.DrawLine(penAxis, 0, cy, pcbGrafico.Width, cy);
                    g.DrawLine(penAxis, cx, 0, cx, pcbGrafico.Height);
                }

                // Dibujar puntos
                using (var pen = new Pen(Color.Red))
                {
                    foreach (var p in puntos)
                    {
                        // Ajustar para que coordenadas (0,0) estén en el centro y eje Y crezca hacia arriba
                        int px = cx + p.X;
                        int py = cy - p.Y;
                        g.DrawRectangle(pen, px, py, 1, 1);
                    }
                }

                // Conectar puntos opcionalmente
                using (var penLine = new Pen(Color.Blue))
                {
                    for (int i = 1; i < puntos.Count; i++)
                    {
                        var p1 = puntos[i - 1];
                        var p2 = puntos[i];
                        int x1 = cx + p1.X;
                        int y1 = cy - p1.Y;
                        int x2 = cx + p2.X;
                        int y2 = cy - p2.Y;
                        g.DrawLine(penLine, x1, y1, x2, y2);
                    }
                }
            }

            pcbGrafico.Invalidate();
        }

        private void groupBox2_Enter(object sender, EventArgs e)
        {

        }
    }
}
